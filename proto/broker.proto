syntax = "proto3";
package broker;

service Broker {
    rpc RegisterNode (RegisterNodeRequest) returns (RegisterNodeResponse);
    rpc ListNodes (ListNodesRequest) returns (ListNodesResponse);
    rpc RegisterPublisher (RegisterPublisherRequest) returns (RegisterPublisherResponse);
    rpc RegisterSubscriber (RegisterSubscriberRequest) returns (RegisterSubscriberResponse);
}

message RegisterNodeRequest {
    string node_name = 1;
    oneof host_ip {
        fixed32 ipv4 = 2;
        bytes ipv6 = 3;
    }
    uint32 port = 4;
}

message RegisterNodeResponse {
    bool ok = 1;
}

message ListNodesRequest {}

message ListNodesResponse {
    repeated Node nodes = 1;
}

message RegisterPublisherRequest {
    string channel_name = 1;
    string msg_type = 2;
}

message RegisterPublisherResponse {
    string proxy_ip = 1;
    int32 port = 2;
}

message RegisterSubscriberRequest {
    string channel_name = 1;
    string msg_type = 2;
}

message RegisterSubscriberResponse {}


message Node {
    string name = 1;
    oneof host_ip {
        fixed32 ipv4 = 2;
        bytes ipv6 = 3;
    }
    uint32 port = 4;
}
